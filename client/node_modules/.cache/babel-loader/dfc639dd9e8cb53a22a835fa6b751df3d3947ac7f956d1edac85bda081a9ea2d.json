{"ast":null,"code":"\"use client\";import{useState,useEffect,useContext}from\"react\";import{Link}from\"react-router-dom\";import{AuthContext}from\"../context/AuthContext\";import styles from\"../styles/Notifications.module.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NotificationList=()=>{const{notifications,unreadCount,notificationsLoading,fetchNotifications,markNotificationAsRead,markAllNotificationsAsRead}=useContext(AuthContext);const[showDropdown,setShowDropdown]=useState(false);const[error,setError]=useState(\"\");useEffect(()=>{if(showDropdown){fetchNotifications().catch(()=>{setError(\"No se pudieron cargar las notificaciones\");});}},[showDropdown,fetchNotifications]);const handleMarkAsRead=async id=>{try{await markNotificationAsRead(id);}catch(error){console.error(\"Error al marcar notificación:\",error);}};const handleMarkAllAsRead=async()=>{try{await markAllNotificationsAsRead();}catch(error){console.error(\"Error al marcar todas las notificaciones:\",error);}};const toggleDropdown=()=>{setShowDropdown(!showDropdown);setError(\"\");};const getNotificationContent=notification=>{const{type,senderUsername}=notification;switch(type){case\"like\":return`${senderUsername} le dio like a tu publicación`;case\"comment\":return`${senderUsername} comentó en tu publicación`;case\"follow\":return`${senderUsername} comenzó a seguirte`;default:return`Nueva notificación de ${senderUsername}`;}};const getNotificationLink=notification=>{const{type,postId,senderUsername}=notification;switch(type){case\"like\":case\"comment\":return`/post/${postId}`;case\"follow\":return`/profile/${senderUsername}`;default:return\"#\";}};const getNotificationIcon=type=>{switch(type){case\"like\":return/*#__PURE__*/_jsx(\"i\",{className:`fas fa-heart ${styles[\"notification-icon\"]} ${styles.like}`});case\"comment\":return/*#__PURE__*/_jsx(\"i\",{className:`fas fa-comment ${styles[\"notification-icon\"]} ${styles.comment}`});case\"follow\":return/*#__PURE__*/_jsx(\"i\",{className:`fas fa-user-plus ${styles[\"notification-icon\"]} ${styles.follow}`});default:return/*#__PURE__*/_jsx(\"i\",{className:`fas fa-bell ${styles[\"notification-icon\"]}`});}};const getImageUrl=imagePath=>{if(!imagePath)return\"/placeholder.svg?height=40&width=40\";if(imagePath.startsWith(\"http\"))return imagePath;return`http://localhost:5000${imagePath}`;};return/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-container\"],children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-bell\"],onClick:toggleDropdown,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-bell\"}),unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:styles[\"notification-badge\"],children:unreadCount})]}),showDropdown&&/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-dropdown\"],children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-header\"],children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Notificaciones\"}),unreadCount>0&&/*#__PURE__*/_jsx(\"button\",{className:styles[\"mark-all-read\"],onClick:handleMarkAllAsRead,children:\"Marcar todas como le\\xEDdas\"})]}),notificationsLoading?/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-loading\"],children:\"Cargando...\"}):error?/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-error\"],children:error}):notifications.length>0?/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-list\"],children:notifications.map(notification=>/*#__PURE__*/_jsxs(Link,{to:getNotificationLink(notification),className:`${styles[\"notification-item\"]} ${!notification.isRead?styles[\"unread\"]:\"\"}`,onClick:()=>!notification.isRead&&handleMarkAsRead(notification.id),children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-avatar\"],children:[/*#__PURE__*/_jsx(\"img\",{src:getImageUrl(notification.senderProfileImage)||\"/placeholder.svg\",alt:notification.senderUsername,className:\"notification-user-image\",onError:e=>{e.target.src=\"/placeholder.svg?height=40&width=40\";}}),getNotificationIcon(notification.type)]}),/*#__PURE__*/_jsxs(\"div\",{className:styles[\"notification-content\"],children:[/*#__PURE__*/_jsx(\"p\",{children:getNotificationContent(notification)}),/*#__PURE__*/_jsx(\"span\",{className:styles[\"notification-time\"],children:new Date(notification.createdAt).toLocaleDateString()})]}),!notification.isRead&&/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-dot\"]})]},notification.id))}):/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-empty\"],children:\"No tienes notificaciones\"}),/*#__PURE__*/_jsx(\"div\",{className:styles[\"notification-footer\"],children:/*#__PURE__*/_jsx(Link,{to:\"/notifications\",className:styles[\"view-all\"],children:\"Ver todas las notificaciones\"})})]})]});};export default NotificationList;","map":{"version":3,"names":["useState","useEffect","useContext","Link","AuthContext","styles","jsx","_jsx","jsxs","_jsxs","NotificationList","notifications","unreadCount","notificationsLoading","fetchNotifications","markNotificationAsRead","markAllNotificationsAsRead","showDropdown","setShowDropdown","error","setError","catch","handleMarkAsRead","id","console","handleMarkAllAsRead","toggleDropdown","getNotificationContent","notification","type","senderUsername","getNotificationLink","postId","getNotificationIcon","className","like","comment","follow","getImageUrl","imagePath","startsWith","children","onClick","length","map","to","isRead","src","senderProfileImage","alt","onError","e","target","Date","createdAt","toLocaleDateString"],"sources":["C:/Users/34615/Desktop/TFC_sys/ProyectoFinal_sys/client/src/components/NotificationList.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect, useContext } from \"react\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { AuthContext } from \"../context/AuthContext\"\r\nimport styles from \"../styles/Notifications.module.css\"\r\n\r\nconst NotificationList = () => {\r\n  const {\r\n    notifications,\r\n    unreadCount,\r\n    notificationsLoading,\r\n    fetchNotifications,\r\n    markNotificationAsRead,\r\n    markAllNotificationsAsRead,\r\n  } = useContext(AuthContext)\r\n\r\n  const [showDropdown, setShowDropdown] = useState(false)\r\n  const [error, setError] = useState(\"\")\r\n\r\n  useEffect(() => {\r\n    if (showDropdown) {\r\n      fetchNotifications().catch(() => {\r\n        setError(\"No se pudieron cargar las notificaciones\")\r\n      })\r\n    }\r\n  }, [showDropdown, fetchNotifications])\r\n\r\n  const handleMarkAsRead = async (id) => {\r\n    try {\r\n      await markNotificationAsRead(id)\r\n    } catch (error) {\r\n      console.error(\"Error al marcar notificación:\", error)\r\n    }\r\n  }\r\n\r\n  const handleMarkAllAsRead = async () => {\r\n    try {\r\n      await markAllNotificationsAsRead()\r\n    } catch (error) {\r\n      console.error(\"Error al marcar todas las notificaciones:\", error)\r\n    }\r\n  }\r\n\r\n  const toggleDropdown = () => {\r\n    setShowDropdown(!showDropdown)\r\n    setError(\"\")\r\n  }\r\n\r\n  const getNotificationContent = (notification) => {\r\n    const { type, senderUsername } = notification\r\n    switch (type) {\r\n      case \"like\":\r\n        return `${senderUsername} le dio like a tu publicación`\r\n      case \"comment\":\r\n        return `${senderUsername} comentó en tu publicación`\r\n      case \"follow\":\r\n        return `${senderUsername} comenzó a seguirte`\r\n      default:\r\n        return `Nueva notificación de ${senderUsername}`\r\n    }\r\n  }\r\n\r\n  const getNotificationLink = (notification) => {\r\n    const { type, postId, senderUsername } = notification\r\n    switch (type) {\r\n      case \"like\":\r\n      case \"comment\":\r\n        return `/post/${postId}`\r\n      case \"follow\":\r\n        return `/profile/${senderUsername}`\r\n      default:\r\n        return \"#\"\r\n    }\r\n  }\r\n\r\n  const getNotificationIcon = (type) => {\r\n    switch (type) {\r\n      case \"like\":\r\n        return <i className={`fas fa-heart ${styles[\"notification-icon\"]} ${styles.like}`}></i>\r\n      case \"comment\":\r\n        return <i className={`fas fa-comment ${styles[\"notification-icon\"]} ${styles.comment}`}></i>\r\n      case \"follow\":\r\n        return <i className={`fas fa-user-plus ${styles[\"notification-icon\"]} ${styles.follow}`}></i>\r\n      default:\r\n        return <i className={`fas fa-bell ${styles[\"notification-icon\"]}`}></i>\r\n    }\r\n  }\r\n\r\n  const getImageUrl = (imagePath) => {\r\n    if (!imagePath) return \"/placeholder.svg?height=40&width=40\"\r\n    if (imagePath.startsWith(\"http\")) return imagePath\r\n    return `http://localhost:5000${imagePath}`\r\n  }\r\n\r\n  return (\r\n    <div className={styles[\"notification-container\"]}>\r\n      <div className={styles[\"notification-bell\"]} onClick={toggleDropdown}>\r\n        <i className=\"fas fa-bell\"></i>\r\n        {unreadCount > 0 && <span className={styles[\"notification-badge\"]}>{unreadCount}</span>}\r\n      </div>\r\n\r\n      {showDropdown && (\r\n        <div className={styles[\"notification-dropdown\"]}>\r\n          <div className={styles[\"notification-header\"]}>\r\n            <h3>Notificaciones</h3>\r\n            {unreadCount > 0 && (\r\n              <button className={styles[\"mark-all-read\"]} onClick={handleMarkAllAsRead}>\r\n                Marcar todas como leídas\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {notificationsLoading ? (\r\n            <div className={styles[\"notification-loading\"]}>Cargando...</div>\r\n          ) : error ? (\r\n            <div className={styles[\"notification-error\"]}>{error}</div>\r\n          ) : notifications.length > 0 ? (\r\n            <div className={styles[\"notification-list\"]}>\r\n              {notifications.map((notification) => (\r\n                <Link\r\n                  key={notification.id}\r\n                  to={getNotificationLink(notification)}\r\n                  className={`${styles[\"notification-item\"]} ${\r\n                    !notification.isRead ? styles[\"unread\"] : \"\"\r\n                  }`}\r\n                  onClick={() => !notification.isRead && handleMarkAsRead(notification.id)}\r\n                >\r\n                  <div className={styles[\"notification-avatar\"]}>\r\n                    <img\r\n                      src={getImageUrl(notification.senderProfileImage) || \"/placeholder.svg\"}\r\n                      alt={notification.senderUsername}\r\n                      className=\"notification-user-image\"\r\n                      onError={(e) => {\r\n                        e.target.src = \"/placeholder.svg?height=40&width=40\"\r\n                      }}\r\n                    />\r\n                    {getNotificationIcon(notification.type)}\r\n                  </div>\r\n                  <div className={styles[\"notification-content\"]}>\r\n                    <p>{getNotificationContent(notification)}</p>\r\n                    <span className={styles[\"notification-time\"]}>\r\n                      {new Date(notification.createdAt).toLocaleDateString()}\r\n                    </span>\r\n                  </div>\r\n                  {!notification.isRead && <div className={styles[\"notification-dot\"]}></div>}\r\n                </Link>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className={styles[\"notification-empty\"]}>No tienes notificaciones</div>\r\n          )}\r\n\r\n          <div className={styles[\"notification-footer\"]}>\r\n            <Link to=\"/notifications\" className={styles[\"view-all\"]}>\r\n              Ver todas las notificaciones\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default NotificationList\r\n"],"mappings":"AAAA,YAAY,CAEZ,OAASA,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CACvD,OAASC,IAAI,KAAQ,kBAAkB,CACvC,OAASC,WAAW,KAAQ,wBAAwB,CACpD,MAAO,CAAAC,MAAM,KAAM,oCAAoC,QAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEvD,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,KAAM,CACJC,aAAa,CACbC,WAAW,CACXC,oBAAoB,CACpBC,kBAAkB,CAClBC,sBAAsB,CACtBC,0BACF,CAAC,CAAGd,UAAU,CAACE,WAAW,CAAC,CAE3B,KAAM,CAACa,YAAY,CAAEC,eAAe,CAAC,CAAGlB,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAACmB,KAAK,CAAEC,QAAQ,CAAC,CAAGpB,QAAQ,CAAC,EAAE,CAAC,CAEtCC,SAAS,CAAC,IAAM,CACd,GAAIgB,YAAY,CAAE,CAChBH,kBAAkB,CAAC,CAAC,CAACO,KAAK,CAAC,IAAM,CAC/BD,QAAQ,CAAC,0CAA0C,CAAC,CACtD,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,CAACH,YAAY,CAAEH,kBAAkB,CAAC,CAAC,CAEtC,KAAM,CAAAQ,gBAAgB,CAAG,KAAO,CAAAC,EAAE,EAAK,CACrC,GAAI,CACF,KAAM,CAAAR,sBAAsB,CAACQ,EAAE,CAAC,CAClC,CAAE,MAAOJ,KAAK,CAAE,CACdK,OAAO,CAACL,KAAK,CAAC,+BAA+B,CAAEA,KAAK,CAAC,CACvD,CACF,CAAC,CAED,KAAM,CAAAM,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,CACF,KAAM,CAAAT,0BAA0B,CAAC,CAAC,CACpC,CAAE,MAAOG,KAAK,CAAE,CACdK,OAAO,CAACL,KAAK,CAAC,2CAA2C,CAAEA,KAAK,CAAC,CACnE,CACF,CAAC,CAED,KAAM,CAAAO,cAAc,CAAGA,CAAA,GAAM,CAC3BR,eAAe,CAAC,CAACD,YAAY,CAAC,CAC9BG,QAAQ,CAAC,EAAE,CAAC,CACd,CAAC,CAED,KAAM,CAAAO,sBAAsB,CAAIC,YAAY,EAAK,CAC/C,KAAM,CAAEC,IAAI,CAAEC,cAAe,CAAC,CAAGF,YAAY,CAC7C,OAAQC,IAAI,EACV,IAAK,MAAM,CACT,MAAO,GAAGC,cAAc,+BAA+B,CACzD,IAAK,SAAS,CACZ,MAAO,GAAGA,cAAc,4BAA4B,CACtD,IAAK,QAAQ,CACX,MAAO,GAAGA,cAAc,qBAAqB,CAC/C,QACE,MAAO,yBAAyBA,cAAc,EAAE,CACpD,CACF,CAAC,CAED,KAAM,CAAAC,mBAAmB,CAAIH,YAAY,EAAK,CAC5C,KAAM,CAAEC,IAAI,CAAEG,MAAM,CAAEF,cAAe,CAAC,CAAGF,YAAY,CACrD,OAAQC,IAAI,EACV,IAAK,MAAM,CACX,IAAK,SAAS,CACZ,MAAO,SAASG,MAAM,EAAE,CAC1B,IAAK,QAAQ,CACX,MAAO,YAAYF,cAAc,EAAE,CACrC,QACE,MAAO,GAAG,CACd,CACF,CAAC,CAED,KAAM,CAAAG,mBAAmB,CAAIJ,IAAI,EAAK,CACpC,OAAQA,IAAI,EACV,IAAK,MAAM,CACT,mBAAOtB,IAAA,MAAG2B,SAAS,CAAE,gBAAgB7B,MAAM,CAAC,mBAAmB,CAAC,IAAIA,MAAM,CAAC8B,IAAI,EAAG,CAAI,CAAC,CACzF,IAAK,SAAS,CACZ,mBAAO5B,IAAA,MAAG2B,SAAS,CAAE,kBAAkB7B,MAAM,CAAC,mBAAmB,CAAC,IAAIA,MAAM,CAAC+B,OAAO,EAAG,CAAI,CAAC,CAC9F,IAAK,QAAQ,CACX,mBAAO7B,IAAA,MAAG2B,SAAS,CAAE,oBAAoB7B,MAAM,CAAC,mBAAmB,CAAC,IAAIA,MAAM,CAACgC,MAAM,EAAG,CAAI,CAAC,CAC/F,QACE,mBAAO9B,IAAA,MAAG2B,SAAS,CAAE,eAAe7B,MAAM,CAAC,mBAAmB,CAAC,EAAG,CAAI,CAAC,CAC3E,CACF,CAAC,CAED,KAAM,CAAAiC,WAAW,CAAIC,SAAS,EAAK,CACjC,GAAI,CAACA,SAAS,CAAE,MAAO,qCAAqC,CAC5D,GAAIA,SAAS,CAACC,UAAU,CAAC,MAAM,CAAC,CAAE,MAAO,CAAAD,SAAS,CAClD,MAAO,wBAAwBA,SAAS,EAAE,CAC5C,CAAC,CAED,mBACE9B,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,wBAAwB,CAAE,CAAAoC,QAAA,eAC/ChC,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,mBAAmB,CAAE,CAACqC,OAAO,CAAEhB,cAAe,CAAAe,QAAA,eACnElC,IAAA,MAAG2B,SAAS,CAAC,aAAa,CAAI,CAAC,CAC9BtB,WAAW,CAAG,CAAC,eAAIL,IAAA,SAAM2B,SAAS,CAAE7B,MAAM,CAAC,oBAAoB,CAAE,CAAAoC,QAAA,CAAE7B,WAAW,CAAO,CAAC,EACpF,CAAC,CAELK,YAAY,eACXR,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,uBAAuB,CAAE,CAAAoC,QAAA,eAC9ChC,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,qBAAqB,CAAE,CAAAoC,QAAA,eAC5ClC,IAAA,OAAAkC,QAAA,CAAI,gBAAc,CAAI,CAAC,CACtB7B,WAAW,CAAG,CAAC,eACdL,IAAA,WAAQ2B,SAAS,CAAE7B,MAAM,CAAC,eAAe,CAAE,CAACqC,OAAO,CAAEjB,mBAAoB,CAAAgB,QAAA,CAAC,6BAE1E,CAAQ,CACT,EACE,CAAC,CAEL5B,oBAAoB,cACnBN,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,sBAAsB,CAAE,CAAAoC,QAAA,CAAC,aAAW,CAAK,CAAC,CAC/DtB,KAAK,cACPZ,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,oBAAoB,CAAE,CAAAoC,QAAA,CAAEtB,KAAK,CAAM,CAAC,CACzDR,aAAa,CAACgC,MAAM,CAAG,CAAC,cAC1BpC,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,mBAAmB,CAAE,CAAAoC,QAAA,CACzC9B,aAAa,CAACiC,GAAG,CAAEhB,YAAY,eAC9BnB,KAAA,CAACN,IAAI,EAEH0C,EAAE,CAAEd,mBAAmB,CAACH,YAAY,CAAE,CACtCM,SAAS,CAAE,GAAG7B,MAAM,CAAC,mBAAmB,CAAC,IACvC,CAACuB,YAAY,CAACkB,MAAM,CAAGzC,MAAM,CAAC,QAAQ,CAAC,CAAG,EAAE,EAC3C,CACHqC,OAAO,CAAEA,CAAA,GAAM,CAACd,YAAY,CAACkB,MAAM,EAAIxB,gBAAgB,CAACM,YAAY,CAACL,EAAE,CAAE,CAAAkB,QAAA,eAEzEhC,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,qBAAqB,CAAE,CAAAoC,QAAA,eAC5ClC,IAAA,QACEwC,GAAG,CAAET,WAAW,CAACV,YAAY,CAACoB,kBAAkB,CAAC,EAAI,kBAAmB,CACxEC,GAAG,CAAErB,YAAY,CAACE,cAAe,CACjCI,SAAS,CAAC,yBAAyB,CACnCgB,OAAO,CAAGC,CAAC,EAAK,CACdA,CAAC,CAACC,MAAM,CAACL,GAAG,CAAG,qCAAqC,CACtD,CAAE,CACH,CAAC,CACDd,mBAAmB,CAACL,YAAY,CAACC,IAAI,CAAC,EACpC,CAAC,cACNpB,KAAA,QAAKyB,SAAS,CAAE7B,MAAM,CAAC,sBAAsB,CAAE,CAAAoC,QAAA,eAC7ClC,IAAA,MAAAkC,QAAA,CAAId,sBAAsB,CAACC,YAAY,CAAC,CAAI,CAAC,cAC7CrB,IAAA,SAAM2B,SAAS,CAAE7B,MAAM,CAAC,mBAAmB,CAAE,CAAAoC,QAAA,CAC1C,GAAI,CAAAY,IAAI,CAACzB,YAAY,CAAC0B,SAAS,CAAC,CAACC,kBAAkB,CAAC,CAAC,CAClD,CAAC,EACJ,CAAC,CACL,CAAC3B,YAAY,CAACkB,MAAM,eAAIvC,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,kBAAkB,CAAE,CAAM,CAAC,GAxBtEuB,YAAY,CAACL,EAyBd,CACP,CAAC,CACC,CAAC,cAENhB,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,oBAAoB,CAAE,CAAAoC,QAAA,CAAC,0BAAwB,CAAK,CAC5E,cAEDlC,IAAA,QAAK2B,SAAS,CAAE7B,MAAM,CAAC,qBAAqB,CAAE,CAAAoC,QAAA,cAC5ClC,IAAA,CAACJ,IAAI,EAAC0C,EAAE,CAAC,gBAAgB,CAACX,SAAS,CAAE7B,MAAM,CAAC,UAAU,CAAE,CAAAoC,QAAA,CAAC,8BAEzD,CAAM,CAAC,CACJ,CAAC,EACH,CACN,EACE,CAAC,CAEV,CAAC,CAED,cAAe,CAAA/B,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}