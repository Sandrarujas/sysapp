{"ast":null,"code":"\"use client\";import{useState,useEffect}from\"react\";import{useAuth}from\"../context/AuthContext\";import styles from\"../styles/Admin.module.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminUsers=()=>{const{isAdmin}=useAuth();const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[pagination,setPagination]=useState({total:0,pages:1});const[currentPage,setCurrentPage]=useState(1);const[searchTerm,setSearchTerm]=useState(\"\");// 👈 Nuevo estado\nuseEffect(()=>{fetchUsers(currentPage);},[currentPage]);const fetchUsers=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;try{const token=localStorage.getItem(\"token\");const response=await fetch(`http://localhost:5000/api/admin/users?page=${page}&limit=10`,{headers:{Authorization:`Bearer ${token}`}});if(response.ok){const data=await response.json();setUsers(data);setPagination({total:data.length,pages:1});// Ajusta si usas paginación real\n}else{const errorText=await response.text();console.error(\"Error en la respuesta:\",response.status,errorText);}}catch(error){console.error(\"Error fetching users:\",error);}finally{setLoading(false);}};const deleteUser=async(userId,username)=>{if(!window.confirm(`¿Estás seguro de que quieres eliminar al usuario \"${username}\"? Esta acción no se puede deshacer.`)){return;}try{const token=localStorage.getItem(\"token\");const response=await fetch(`http://localhost:5000/api/admin/users/${userId}`,{method:\"DELETE\",headers:{Authorization:`Bearer ${token}`}});if(response.ok){fetchUsers(currentPage);alert(\"Usuario eliminado correctamente\");}else{const error=await response.json();alert(`Error: ${error.error}`);}}catch(error){console.error(\"Error deleting user:\",error);alert(\"Error al eliminar el usuario\");}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:styles[\"admin-loading\"],children:\"Cargando usuarios...\"});}const filteredUsers=users.filter(user=>user.username.toLowerCase().includes(searchTerm.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:styles[\"admin-users\"],children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"admin-header\"],children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Gesti\\xF3n de Usuarios\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total: \",pagination.total,\" usuarios\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filtrar por nombre de usuario\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:styles[\"filter-input\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:styles[\"users-table\"],children:/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Usuario\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Rol\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Fecha Registro\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredUsers.length>0?filteredUsers.map(user=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:user.id}),/*#__PURE__*/_jsx(\"td\",{children:user.username}),/*#__PURE__*/_jsx(\"td\",{children:user.email}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:`${styles[\"role-badge\"]} ${styles[user.role]}`,children:user.role})}),/*#__PURE__*/_jsx(\"td\",{children:new Date(user.created_at).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:styles[\"user-actions\"],children:isAdmin()&&user.role!==\"admin\"&&/*#__PURE__*/_jsx(\"button\",{className:`${styles[\"action-btn\"]} ${styles[\"delete\"]}`,onClick:()=>deleteUser(user.id,user.username),children:\"Eliminar\"})})})]},user.id)):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",children:\"No se encontraron usuarios con ese nombre.\"})})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:styles[\"pagination\"],children:[/*#__PURE__*/_jsx(\"button\",{disabled:currentPage===1,onClick:()=>setCurrentPage(currentPage-1),children:\"Anterior\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"P\\xE1gina \",currentPage,\" de \",pagination.pages]}),/*#__PURE__*/_jsx(\"button\",{disabled:currentPage===pagination.pages,onClick:()=>setCurrentPage(currentPage+1),children:\"Siguiente\"})]})]});};export default AdminUsers;","map":{"version":3,"names":["useState","useEffect","useAuth","styles","jsx","_jsx","jsxs","_jsxs","AdminUsers","isAdmin","users","setUsers","loading","setLoading","pagination","setPagination","total","pages","currentPage","setCurrentPage","searchTerm","setSearchTerm","fetchUsers","page","arguments","length","undefined","token","localStorage","getItem","response","fetch","headers","Authorization","ok","data","json","errorText","text","console","error","status","deleteUser","userId","username","window","confirm","method","alert","className","children","filteredUsers","filter","user","toLowerCase","includes","type","placeholder","value","onChange","e","target","map","id","email","role","Date","created_at","toLocaleDateString","onClick","colSpan","disabled"],"sources":["C:/Users/34615/Desktop/TFC_sys/ProyectoFinal_sys/client/src/pages/AdminUsers.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { useAuth } from \"../context/AuthContext\"\r\nimport styles from \"../styles/Admin.module.css\"\r\n\r\nconst AdminUsers = () => {\r\n  const { isAdmin } = useAuth()\r\n  const [users, setUsers] = useState([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [pagination, setPagination] = useState({ total: 0, pages: 1 })\r\n  const [currentPage, setCurrentPage] = useState(1)\r\n  const [searchTerm, setSearchTerm] = useState(\"\") // 👈 Nuevo estado\r\n\r\n  useEffect(() => {\r\n    fetchUsers(currentPage)\r\n  }, [currentPage])\r\n\r\n  const fetchUsers = async (page = 1) => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\")\r\n      const response = await fetch(`http://localhost:5000/api/admin/users?page=${page}&limit=10`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setUsers(data)\r\n        setPagination({ total: data.length, pages: 1 }) // Ajusta si usas paginación real\r\n      } else {\r\n        const errorText = await response.text()\r\n        console.error(\"Error en la respuesta:\", response.status, errorText)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching users:\", error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const deleteUser = async (userId, username) => {\r\n    if (!window.confirm(`¿Estás seguro de que quieres eliminar al usuario \"${username}\"? Esta acción no se puede deshacer.`)) {\r\n      return\r\n    }\r\n\r\n    try {\r\n      const token = localStorage.getItem(\"token\")\r\n      const response = await fetch(`http://localhost:5000/api/admin/users/${userId}`, {\r\n        method: \"DELETE\",\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      })\r\n\r\n      if (response.ok) {\r\n        fetchUsers(currentPage)\r\n        alert(\"Usuario eliminado correctamente\")\r\n      } else {\r\n        const error = await response.json()\r\n        alert(`Error: ${error.error}`)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting user:\", error)\r\n      alert(\"Error al eliminar el usuario\")\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className={styles[\"admin-loading\"]}>Cargando usuarios...</div>\r\n  }\r\n\r\n  const filteredUsers = users.filter(user =>\r\n    user.username.toLowerCase().includes(searchTerm.toLowerCase())\r\n  )\r\n\r\n  return (\r\n    <div className={styles[\"admin-users\"]}>\r\n      <div className={styles[\"admin-header\"]}>\r\n        <h1>Gestión de Usuarios</h1>\r\n        <p>Total: {pagination.total} usuarios</p>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Filtrar por nombre de usuario\"\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n          className={styles[\"filter-input\"]}\r\n        />\r\n      </div>\r\n\r\n      <div className={styles[\"users-table\"]}>\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>ID</th>\r\n              <th>Usuario</th>\r\n              <th>Email</th>\r\n              <th>Rol</th>\r\n              <th>Fecha Registro</th>\r\n              <th>Acciones</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredUsers.length > 0 ? (\r\n              filteredUsers.map((user) => (\r\n                <tr key={user.id}>\r\n                  <td>{user.id}</td>\r\n                  <td>{user.username}</td>\r\n                  <td>{user.email}</td>\r\n                  <td>\r\n                    <span className={`${styles[\"role-badge\"]} ${styles[user.role]}`}>\r\n                      {user.role}\r\n                    </span>\r\n                  </td>\r\n                  <td>{new Date(user.created_at).toLocaleDateString()}</td>\r\n                  <td>\r\n                    <div className={styles[\"user-actions\"]}>\r\n                      {isAdmin() && user.role !== \"admin\" && (\r\n                        <button\r\n                          className={`${styles[\"action-btn\"]} ${styles[\"delete\"]}`}\r\n                          onClick={() => deleteUser(user.id, user.username)}\r\n                        >\r\n                          Eliminar\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            ) : (\r\n              <tr>\r\n                <td colSpan=\"6\">No se encontraron usuarios con ese nombre.</td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <div className={styles[\"pagination\"]}>\r\n        <button\r\n          disabled={currentPage === 1}\r\n          onClick={() => setCurrentPage(currentPage - 1)}\r\n        >\r\n          Anterior\r\n        </button>\r\n        <span>\r\n          Página {currentPage} de {pagination.pages}\r\n        </span>\r\n        <button\r\n          disabled={currentPage === pagination.pages}\r\n          onClick={() => setCurrentPage(currentPage + 1)}\r\n        >\r\n          Siguiente\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default AdminUsers\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}