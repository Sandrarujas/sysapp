{"ast":null,"code":"\"use client\";import{useState,useEffect}from\"react\";import axios from\"axios\";import styles from\"../styles/EditPostModal.module.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EditPostModal=_ref=>{let{isOpen,onClose,post,onPostUpdate}=_ref;const[content,setContent]=useState(\"\");const[image,setImage]=useState(null);const[previewImage,setPreviewImage]=useState(\"\");const[keepExistingImage,setKeepExistingImage]=useState(true);const[loading,setLoading]=useState(false);const[error,setError]=useState(\"\");useEffect(()=>{if(post){setContent(post.content||\"\");if(post.image){setPreviewImage(getImageUrl(post.image));}else{setPreviewImage(\"\");}setKeepExistingImage(!!post.image);}},[post]);// Función para construir la URL completa de la imagen\nconst getImageUrl=imagePath=>{if(!imagePath)return null;// Si la ruta ya es una URL completa, devolverla tal cual\nif(imagePath.startsWith(\"http\"))return imagePath;// Construir la URL completa\nreturn`http://localhost:5000${imagePath}`;};const handleImageChange=e=>{const file=e.target.files[0];if(file){setImage(file);setPreviewImage(URL.createObjectURL(file));setKeepExistingImage(false);}};const handleRemoveImage=()=>{setImage(null);setPreviewImage(\"\");setKeepExistingImage(false);};const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError(\"\");if(!content&&!keepExistingImage&&!image){setError(\"La publicación debe tener contenido o imagen\");setLoading(false);return;}try{const formData=new FormData();formData.append(\"content\",content);if(image){formData.append(\"image\",image);}else if(!keepExistingImage&&post.image){formData.append(\"image\",\"\");}const res=await axios.put(`http://localhost:5000/api/posts/${post.id}`,formData,{headers:{\"Content-Type\":\"multipart/form-data\"}});onPostUpdate({...post,content:res.data.content,image:res.data.image});onClose();}catch(error){var _error$response,_error$response$data;console.error(\"Error al actualizar publicación:\",error);setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Error al actualizar la publicación\");}finally{setLoading(false);}};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:styles[\"modal-overlay\"],children:/*#__PURE__*/_jsxs(\"div\",{className:styles[\"edit-post-modal\"],children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"modal-header\"],children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Editar Publicaci\\xF3n\"}),/*#__PURE__*/_jsx(\"button\",{className:styles[\"close-button\"],onClick:onClose,children:\"\\xD7\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:styles[\"error-message\"],children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles[\"form-group\"],children:[/*#__PURE__*/_jsx(\"label\",{children:\"Contenido\"}),/*#__PURE__*/_jsx(\"textarea\",{value:content,onChange:e=>setContent(e.target.value),placeholder:\"\\xBFQu\\xE9 est\\xE1s pensando?\",rows:4})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles[\"form-group\"],children:[/*#__PURE__*/_jsx(\"label\",{children:\"Imagen\"}),previewImage?/*#__PURE__*/_jsxs(\"div\",{className:styles[\"image-preview-container\"],children:[/*#__PURE__*/_jsx(\"img\",{src:previewImage||\"/placeholder.svg\",alt:\"Vista previa\",className:styles[\"image-preview\"]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:styles[\"remove-image-button\"],onClick:handleRemoveImage,children:\"Eliminar imagen\"})]}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleImageChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles[\"form-actions\"],children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:styles[\"cancel-button\"],onClick:onClose,disabled:loading,children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:styles[\"save-button\"],disabled:loading,children:loading?\"Guardando...\":\"Guardar Cambios\"})]})]})]})});};export default EditPostModal;","map":{"version":3,"names":["useState","useEffect","axios","styles","jsx","_jsx","jsxs","_jsxs","EditPostModal","_ref","isOpen","onClose","post","onPostUpdate","content","setContent","image","setImage","previewImage","setPreviewImage","keepExistingImage","setKeepExistingImage","loading","setLoading","error","setError","getImageUrl","imagePath","startsWith","handleImageChange","e","file","target","files","URL","createObjectURL","handleRemoveImage","handleSubmit","preventDefault","formData","FormData","append","res","put","id","headers","data","_error$response","_error$response$data","console","response","message","className","children","onClick","onSubmit","value","onChange","placeholder","rows","src","alt","type","accept","disabled"],"sources":["C:/Users/34615/Desktop/TFC_sys/ProyectoFinal_sys/client/src/components/EditPostModal.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport axios from \"axios\"\r\nimport styles from \"../styles/EditPostModal.module.css\"\r\n\r\nconst EditPostModal = ({ isOpen, onClose, post, onPostUpdate }) => {\r\n  const [content, setContent] = useState(\"\")\r\n  const [image, setImage] = useState(null)\r\n  const [previewImage, setPreviewImage] = useState(\"\")\r\n  const [keepExistingImage, setKeepExistingImage] = useState(true)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState(\"\")\r\n\r\n  useEffect(() => {\r\n    if (post) {\r\n      setContent(post.content || \"\")\r\n      if (post.image) {\r\n        setPreviewImage(getImageUrl(post.image))\r\n      } else {\r\n        setPreviewImage(\"\")\r\n      }\r\n      setKeepExistingImage(!!post.image)\r\n    }\r\n  }, [post])\r\n\r\n  // Función para construir la URL completa de la imagen\r\n  const getImageUrl = (imagePath) => {\r\n    if (!imagePath) return null\r\n\r\n    // Si la ruta ya es una URL completa, devolverla tal cual\r\n    if (imagePath.startsWith(\"http\")) return imagePath\r\n\r\n    // Construir la URL completa\r\n    return `http://localhost:5000${imagePath}`\r\n  }\r\n\r\n  const handleImageChange = (e) => {\r\n    const file = e.target.files[0]\r\n    if (file) {\r\n      setImage(file)\r\n      setPreviewImage(URL.createObjectURL(file))\r\n      setKeepExistingImage(false)\r\n    }\r\n  }\r\n\r\n  const handleRemoveImage = () => {\r\n    setImage(null)\r\n    setPreviewImage(\"\")\r\n    setKeepExistingImage(false)\r\n  }\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault()\r\n    setLoading(true)\r\n    setError(\"\")\r\n\r\n    if (!content && !keepExistingImage && !image) {\r\n      setError(\"La publicación debe tener contenido o imagen\")\r\n      setLoading(false)\r\n      return\r\n    }\r\n\r\n    try {\r\n      const formData = new FormData()\r\n      formData.append(\"content\", content)\r\n\r\n      if (image) {\r\n        formData.append(\"image\", image)\r\n      } else if (!keepExistingImage && post.image) {\r\n        formData.append(\"image\", \"\")\r\n      }\r\n\r\n      const res = await axios.put(`http://localhost:5000/api/posts/${post.id}`, formData, {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n        },\r\n      })\r\n\r\n      onPostUpdate({\r\n        ...post,\r\n        content: res.data.content,\r\n        image: res.data.image,\r\n      })\r\n\r\n      onClose()\r\n    } catch (error) {\r\n      console.error(\"Error al actualizar publicación:\", error)\r\n      setError(error.response?.data?.message || \"Error al actualizar la publicación\")\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  if (!isOpen) return null\r\n\r\n  return (\r\n    <div className={styles[\"modal-overlay\"]}>\r\n      <div className={styles[\"edit-post-modal\"]}>\r\n        <div className={styles[\"modal-header\"]}>\r\n          <h2>Editar Publicación</h2>\r\n          <button className={styles[\"close-button\"]} onClick={onClose}>\r\n            &times;\r\n          </button>\r\n        </div>\r\n\r\n        {error && <div className={styles[\"error-message\"]}>{error}</div>}\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className={styles[\"form-group\"]}>\r\n            <label>Contenido</label>\r\n            <textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder=\"¿Qué estás pensando?\"\r\n              rows={4}\r\n            ></textarea>\r\n          </div>\r\n\r\n          <div className={styles[\"form-group\"]}>\r\n            <label>Imagen</label>\r\n            {previewImage ? (\r\n              <div className={styles[\"image-preview-container\"]}>\r\n                <img\r\n                  src={previewImage || \"/placeholder.svg\"}\r\n                  alt=\"Vista previa\"\r\n                  className={styles[\"image-preview\"]}\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className={styles[\"remove-image-button\"]}\r\n                  onClick={handleRemoveImage}\r\n                >\r\n                  Eliminar imagen\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <input type=\"file\" accept=\"image/*\" onChange={handleImageChange} />\r\n            )}\r\n          </div>\r\n\r\n          <div className={styles[\"form-actions\"]}>\r\n            <button\r\n              type=\"button\"\r\n              className={styles[\"cancel-button\"]}\r\n              onClick={onClose}\r\n              disabled={loading}\r\n            >\r\n              Cancelar\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className={styles[\"save-button\"]}\r\n              disabled={loading}\r\n            >\r\n              {loading ? \"Guardando...\" : \"Guardar Cambios\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default EditPostModal\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}